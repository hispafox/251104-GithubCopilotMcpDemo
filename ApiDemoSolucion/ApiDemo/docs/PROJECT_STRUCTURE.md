# Estructura del Proyecto - Task Management API

## ?? Arquitectura de Carpetas

```
ApiDemo/
?
??? ?? Core/   # Capa de Dominio (Domain Layer)
?   ??? ?? Entities/
?   ?   ??? TaskEntity.cs     # Entidad principal del dominio
?   ??? ?? Enums/
?   ?   ??? TaskStatus.cs             # Estados: Pending, InProgress, Completed
?   ?   ??? TaskPriority.cs           # Prioridades: Low, Medium, High
?   ??? ?? Interfaces/
?       ??? IRepository.cs    # Interfaz del repositorio genérico
?       ??? IUnitOfWork.cs         # Interfaz del Unit of Work
?
??? ?? Application/ # Capa de Aplicación (Application Layer)
?   ??? ?? DTOs/
?   ?   ??? TaskDto.cs        # DTO de lectura
?   ?   ??? CreateTaskDto.cs   # DTO para crear
?   ?   ??? UpdateTaskDto.cs          # DTO para actualizar
?   ??? ?? Validators/
?   ?   ??? CreateTaskDtoValidator.cs # Validación con FluentValidation
?   ?   ??? UpdateTaskDtoValidator.cs # Validación con FluentValidation
?   ??? ?? Mappings/
?   ?   ??? MappingProfile.cs # Configuración de AutoMapper
?   ??? ?? Services/
?   ??? ITaskService.cs     # Interfaz del servicio
?   ??? TaskService.cs            # Lógica de negocio
?
??? ?? Infrastructure/     # Capa de Infraestructura (Infrastructure Layer)
?   ??? ?? Data/
?   ?   ??? ApplicationDbContext.cs   # DbContext de EF Core
?   ?   ??? DbInitializer.cs          # Datos de ejemplo (seed data)
?   ??? ?? Repositories/
?   ?   ??? Repository.cs         # Implementación del repositorio genérico
?   ??? ?? UnitOfWork/
?       ??? UnitOfWork.cs          # Implementación del Unit of Work
?
??? ?? Controllers/           # Capa de Presentación (Presentation Layer)
?   ??? TasksController.cs  # Controlador Web API con endpoints REST
?
??? ?? Middlewares/          # Middleware personalizado
?   ??? ErrorHandlingMiddleware.cs  # Manejo centralizado de errores
?
??? ?? Migrations/                    # Migraciones de Entity Framework
?   ??? YYYYMMDDHHMMSS_InitialCreate.cs
?   ??? ApplicationDbContextModelSnapshot.cs
?
??? ?? docs/  # Documentación
?   ??? ?? prd/
?   ?   ??? PRD_Demo.md    # Product Requirements Document
?   ??? API_USAGE_GUIDE.md            # Guía de uso de la API
?
??? ?? Program.cs           # Punto de entrada y configuración
??? ?? appsettings.json    # Configuración general
??? ?? appsettings.Development.json   # Configuración de desarrollo
??? ?? ApiDemo.csproj   # Archivo de proyecto
??? ?? README.md# Documentación principal
??? ?? .gitignore      # Archivos a ignorar en Git
```

## ?? Responsabilidades por Capa

### 1?? Core Layer (Dominio)
**Responsabilidad**: Definir las entidades del negocio y las abstracciones principales.

- ? **Sin dependencias externas** (más interna)
- ? Define el modelo de dominio (`TaskEntity`)
- ? Define enumeraciones del negocio
- ? Define interfaces para repositorio y UoW
- ? NO contiene lógica de infraestructura
- ? NO depende de EF Core directamente

**Archivos clave:**
- `TaskEntity.cs`: Modelo de la tarea con propiedades y validaciones de dominio
- `IRepository<T>`: Contrato para operaciones CRUD genéricas
- `IUnitOfWork`: Contrato para gestión de transacciones

---

### 2?? Application Layer (Aplicación)
**Responsabilidad**: Orquestar la lógica de negocio y coordinar entre capas.

- ? Define DTOs para entrada/salida
- ? Implementa validaciones con FluentValidation
- ? Define mapeos con AutoMapper
- ? Contiene servicios de aplicación
- ? Depende de Core
- ? NO conoce detalles de infraestructura
- ? NO accede directamente a la base de datos

**Archivos clave:**
- `TaskService.cs`: Lógica de negocio (CRUD + filtros)
- `CreateTaskDtoValidator.cs`: Validaciones de entrada
- `MappingProfile.cs`: Transformaciones DTO ? Entity

---

### 3?? Infrastructure Layer (Infraestructura)
**Responsabilidad**: Implementar detalles técnicos de persistencia y acceso a datos.

- ? Implementa interfaces de Core
- ? Configura Entity Framework Core
- ? Maneja conexión a base de datos
- ? Implementa repositorios concretos
- ? Gestiona migraciones
- ? NO contiene lógica de negocio

**Archivos clave:**
- `ApplicationDbContext.cs`: Configuración de EF Core y entidades
- `Repository<T>.cs`: Implementación genérica del patrón Repository
- `UnitOfWork.cs`: Coordinación de repositorios y transacciones

---

### 4?? API Layer (Presentación)
**Responsabilidad**: Exponer endpoints HTTP y manejar peticiones/respuestas.

- ? Define controladores REST
- ? Mapea rutas HTTP
- ? Valida entrada con validators
- ? Maneja respuestas HTTP
- ? Configura middleware
- ? Depende de Application y Core
- ? NO contiene lógica de negocio compleja

**Archivos clave:**
- `TasksController.cs`: Endpoints REST para tareas
- `ErrorHandlingMiddleware.cs`: Manejo global de excepciones
- `Program.cs`: Configuración de DI, middleware, servicios

---

## ?? Flujo de una Petición

```
???????????????????????????????????????????????????????????????
?       1. HTTP Request     ?
?         POST /api/tasks + JSON Body              ?
???????????????????????????????????????????????????????????????
          ?
    ?
???????????????????????????????????????????????????????????????
?  2. ErrorHandlingMiddleware        ?
?Captura excepciones globales    ?
???????????????????????????????????????????????????????????????
    ?
            ?
???????????????????????????????????????????????????????????????
?    3. TasksController    ?
?         • Recibe CreateTaskDto       ?
?         • Ejecuta validación (FluentValidation)      ?
?       • Si válido, llama a TaskService          ?
???????????????????????????????????????????????????????????????
          ?
      ?
???????????????????????????????????????????????????????????????
?    4. TaskService   ?
?         • Mapea DTO ? Entity (AutoMapper)       ?
?       • Ejecuta lógica de negocio      ?
?         • Llama a UnitOfWork.Tasks.AddAsync()            ?
???????????????????????????????????????????????????????????????
            ?
             ?
???????????????????????????????????????????????????????????????
?   5. UnitOfWork & Repository             ?
?       • Repository agrega entity al DbSet  ?
?     • UnitOfWork.SaveChangesAsync() confirma      ?
???????????????????????????????????????????????????????????????
   ?
       ?
???????????????????????????????????????????????????????????????
?     6. ApplicationDbContext (EF Core)              ?
?    • Genera SQL INSERT         ?
?         • Ejecuta contra LocalDB      ?
???????????????????????????????????????????????????????????????
   ?
          ?
???????????????????????????????????????????????????????????????
?       7. TaskService devuelve     ?
?       • Mapea Entity ? TaskDto (AutoMapper)          ?
?      • Retorna TaskDto al controller              ?
???????????????????????????????????????????????????????????????
    ?
       ?
???????????????????????????????????????????????????????????????
?  8. TasksController responde  ?
?     • Retorna 201 Created        ?
?         • Location header con URL del recurso            ?
?    • Body con TaskDto serializado en JSON          ?
???????????????????????????????????????????????????????????????
```

---

## ?? Patrones de Diseño Implementados

### 1. Repository Pattern
**Ubicación**: `Infrastructure/Repositories/Repository.cs`

**Propósito**: Abstraer el acceso a datos y centralizar queries.

```csharp
public interface IRepository<T> where T : class
{
    Task<T?> GetByIdAsync(Guid id);
    Task<IEnumerable<T>> GetAllAsync();
    Task<IEnumerable<T>> FindAsync(Expression<Func<T, bool>> predicate);
    Task AddAsync(T entity);
    void Update(T entity);
    void Delete(T entity);
}
```

**Beneficios**:
- ? Desacopla la lógica de negocio del ORM
- ? Facilita testing (mock del repositorio)
- ? Centraliza queries comunes

---

### 2. Unit of Work Pattern
**Ubicación**: `Infrastructure/UnitOfWork/UnitOfWork.cs`

**Propósito**: Coordinar múltiples repositorios en una transacción.

```csharp
public interface IUnitOfWork : IDisposable
{
    IRepository<TaskEntity> Tasks { get; }
    Task<int> SaveChangesAsync();
}
```

**Beneficios**:
- ? Garantiza atomicidad (todo o nada)
- ? Gestiona el ciclo de vida del DbContext
- ? Simplifica el código de servicios

---

### 3. DTO Pattern
**Ubicación**: `Application/DTOs/`

**Propósito**: Separar modelos de dominio de modelos de transferencia.

- `TaskDto` - Para lectura (GET)
- `CreateTaskDto` - Para creación (POST)
- `UpdateTaskDto` - Para actualización (PUT)

**Beneficios**:
- ? Controla qué datos se exponen
- ? Evita over-posting/under-posting
- ? Permite validaciones específicas por operación

---

### 4. Dependency Injection
**Ubicación**: `Program.cs`

**Configuración**:
```csharp
builder.Services.AddDbContext<ApplicationDbContext>(...);
builder.Services.AddScoped<IUnitOfWork, UnitOfWork>();
builder.Services.AddScoped<ITaskService, TaskService>();
builder.Services.AddAutoMapper(typeof(MappingProfile));
builder.Services.AddValidatorsFromAssemblyContaining<CreateTaskDtoValidator>();
```

**Beneficios**:
- ? Inversión de control
- ? Facilita testing
- ? Gestión automática del ciclo de vida

---

## ?? Paquetes NuGet Utilizados

| Paquete | Versión | Propósito |
|---------|---------|-----------|
| `Microsoft.EntityFrameworkCore` | 8.0.* | ORM principal |
| `Microsoft.EntityFrameworkCore.SqlServer` | 8.0.* | Provider para SQL Server |
| `Microsoft.EntityFrameworkCore.Tools` | 8.0.* | Herramientas CLI (migraciones) |
| `AutoMapper.Extensions.Microsoft.DependencyInjection` | 12.0.* | Mapeo automático de objetos |
| `FluentValidation.AspNetCore` | 11.3.* | Validación declarativa |
| `Swashbuckle.AspNetCore` | 6.6.2 | Documentación Swagger/OpenAPI |

---

## ??? Modelo de Datos

### TaskEntity (Tabla: Tasks)

```sql
CREATE TABLE [Tasks] (
    [Id] uniqueidentifier NOT NULL PRIMARY KEY,
    [Title] nvarchar(200) NOT NULL,
    [Description] nvarchar(1000) NULL,
    [Status] nvarchar(max) NOT NULL,
    [Priority] nvarchar(max) NOT NULL,
    [DueDate] datetime2 NULL,
    [CreatedAt] datetime2 NOT NULL,
  [UpdatedAt] datetime2 NOT NULL
);
```

**Enums almacenados como strings**:
- `Status`: "Pending", "InProgress", "Completed"
- `Priority`: "Low", "Medium", "High"

---

## ?? Comandos Rápidos

### Compilar
```bash
dotnet build
```

### Ejecutar
```bash
dotnet run
```

### Crear migración
```bash
dotnet ef migrations add MigrationName
```

### Aplicar migración
```bash
dotnet ef database update
```

### Ver SQL de migración
```bash
dotnet ef migrations script
```

### Limpiar y reconstruir
```bash
dotnet clean
dotnet build
```

---

## ?? Documentación Relacionada

- **README.md** - Documentación principal del proyecto
- **API_USAGE_GUIDE.md** - Guía de uso con ejemplos
- **PRD_Demo.md** - Product Requirements Document
- **Swagger UI** - `https://localhost:7xxx/swagger`

---

## ? Principios SOLID Aplicados

| Principio | Implementación |
|-----------|---------------|
| **S** - Single Responsibility | Cada clase tiene una única responsabilidad |
| **O** - Open/Closed | Extensible mediante interfaces (IRepository, ITaskService) |
| **L** - Liskov Substitution | Repository<T> puede sustituirse por cualquier implementación |
| **I** - Interface Segregation | Interfaces pequeñas y específicas |
| **D** - Dependency Inversion | Dependemos de abstracciones, no de implementaciones |

---

## ?? Conceptos Clave

### Clean Architecture
- ? Capas bien definidas
- ? Dependencias apuntan hacia adentro
- ? Core no depende de nadie
- ? Fácil de testear

### Separation of Concerns
- ? Dominio separado de infraestructura
- ? DTOs vs Entities
- ? Validación en Application layer
- ? Persistencia en Infrastructure layer

### CQRS Básico
- ? DTOs diferentes para lectura y escritura
- ? CreateTaskDto ? UpdateTaskDto ? TaskDto

---

## ?? Soporte

Para más información o preguntas:
- Ver documentación en `/docs`
- Revisar código fuente
- Consultar Swagger UI
- Revisar logs en consola

---

**Última actualización**: 2024-11-06
**Versión de la API**: 1.0
